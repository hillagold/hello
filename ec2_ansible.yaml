---
- name: ec2 launcher
  hosts: localhost
  connection: local

  tasks:
    - name: launching ec2
      ec2:
        instance_type: t2.micro
        key_name: hillagold
        image: ami-00bb6f60
        region: us-west-2
        group: deafult
        count: 1
        vpc_subnet_id: subnet-bd8434e0
        wait: yes
        assign_public_ip: yes
    - debug:
         msg: System {{ inventory_hostname }} has gateway {{ ansible_default_ipv4.gateway }}
         when: ansible_default_ipv4.gateway is defined

    - name: Terminate instances that were previously launched
      amazon.aws.ec2:
        state: 'absent'
        instance_ids: '{{ ec2.instance_ids }}'
